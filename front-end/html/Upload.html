<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload do seu dataset</title>
</head>
<link href = "/styles/stylesUpload.css" rel = "stylesheet">
<style>
</style>
<body>
    <div class = "load" id = "load"></div>
    <p id = "LoadLabel"></p>
    <button id = "back" onclick = "back()"></button>
    <div id = "container">
        <form class = "form" id = "myForm">
            <label for="fileSend">Envie aqui o arquivo de Excel com extensão xlsx</label><br>
            <input type = "file" name = "excel" id = "fileSend" placeholder="Coloque aqui seu arquivo..."><br>
            <button class = "button" type = "submit"><i class = "far fa-paper-plane"></i>Enviar arquivo</button>
        </form>
        <button class = "button" id = "ButtonMine" onclick = "buttonMine()">Minerar dados</button>

        <p id = "labelUpload">Status do upload: </p>
        <p id = "status"></p>
        <p id = "labelStatus">Status da mineração: (A mineração de dados pode demorar por volta de 20 segundos devido a ela ser bem pesada)</p>
        <p id = "statusMine"></p>
        <p id = "statusServer"></p>
    </div>
    <script>
        const form = document.getElementById('myForm')
        const inputFile = document.getElementById('fileSend')

        form.addEventListener("submit", async e =>{
            document.getElementById("statusServer").innerHTML = ""
            document.getElementById("status").innerHTML = ""
            document.getElementById('load').style.visibility = "visible";
            document.getElementById("LoadLabel").innerHTML = "Fazendo o upload do dataset..."
            e.preventDefault()

            const header = new Headers()
            const formData = new FormData()
            
            formData.append("excel", fileSend.files[0])
            header.append("id","4iew9moc9v")

            url = "http://localhost:5000/Upload"

            try{
            const response = await fetch(url,{
                method: "post",
                headers: header,
                body: formData
            })

                let result = await response.json()

                if (result.sucess == "Upload feito com sucesso"){
                    document.getElementById("status").innerHTML = "Sucesso: "+result.sucess;
                    document.getElementsByTagName("style")[0].innerHTML += "#status{color: green; margin-top: -15px}"
                }
                else if (result.error != ""){
                    document.getElementById("status").innerHTML = "Erro: "+result.error;
                    document.getElementsByTagName("style")[0].innerHTML += "#status{color: red; margin-top: -15px}"
                }
            }catch{
                document.getElementById("statusServer").innerHTML = 'Falha no upload do dataset'
                document.getElementsByTagName("style")[0].innerHTML += "#statusServer{color: red}"
                document.getElementById('load').style.visibility = "hidden";
                document.getElementById("LoadLabel").innerHTML = ""
            }
            document.getElementById('load').style.visibility = "hidden";
            document.getElementById("LoadLabel").innerHTML = ""
        })

        async function buttonMine(){
            document.getElementById("statusServer").innerHTML = ""
            document.getElementById("statusMine").innerHTML = ""
            document.getElementById('load').style.visibility = "visible";
            document.getElementById("LoadLabel").innerHTML = "Fazendo a mineração de dados do dataset..."
            const header = new Headers()
            header.append("id","4iew9moc9v")
            try{
            const response = await fetch('http://localhost:5000/Data_Mining',{
                method:"PUT",
                headers:header
            
            })
            let result = await response.json()

            if (result.sucess == "A mineração de dados foi concluida"){
                document.getElementById("statusMine").innerHTML = "Sucesso: "+result.sucess;
                document.getElementsByTagName("style")[0].innerHTML += "#statusMine{color: green; margin-top: -15px}"
            }
            else if (result.error == "Por favor faça o upload de um dataset compátivel com o modelo de mineração"){
                document.getElementById("statusMine").innerHTML = "Error: "+result.error;
                document.getElementsByTagName("style")[0].innerHTML += "#statusMine{color: red; margin-top: -15px}"
            }
            }catch{
                document.getElementById("statusServer").innerHTML = 'Falha na mineração de dados'
                document.getElementsByTagName("style")[0].innerHTML += "#statusServer{color: red}"
                document.getElementById('load').style.visibility = "hidden";
                document.getElementById("LoadLabel").innerHTML = ""
            }
            document.getElementById('load').style.visibility = "hidden";
            document.getElementById("LoadLabel").innerHTML = ""
        }

        function back(){
            window.open("main.html")
            window.close()
        }
    </script>
</body>
</html>